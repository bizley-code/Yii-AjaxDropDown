/*!
 * AjaxDropDown v1.3.2 | Pawel Bizley Brzozowski | https://github.com/bizley-code/Yii-AjaxDropDown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{accl:"active",addc:"",dely:300,dicl:"disabled",ercl:"",erst:"",hecl:"",hest:"",hicl:"hidden",jsev:!0,keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",trig:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),t=" ajaxDropDownRecord",l="</a></li>",r="a.ajaxDropDownNext",s="a.ajaxDropDownPrev",i="button.ajaxDropDownSingleRemove",o="button.ajaxDropDownToggle",d='><a href="#" class="ajaxDropDownResult" data-id="',p="input[type=text]",c="</li>",f='<li class="dropdown-header',v="li.ajaxDropDownPage",m="li.ajaxDropDownPages",u='<li class="ajaxDropDownPages ajaxDropDownPage',h="li.ajaxDropDownSelected",g="span.ajaxDropDownPageNumber",D=' style="',w="ul.ajaxDropDownMenu",j=null,x=[],b=new Function("id","selection",n.onrm),y=new Function("id","label","selection",n.onsl),C=function(a){var e=[];for(var n in x)x[n].id!=a&&e.push(x[n]);x=e},R=function(a){for(var e in x)if(x[e].id==a)return!0;return!1},N=this.find("ul.ajaxDropDownResults"),k=this.find(i),P=this.find(w),S=this.find(p),T=this.find(o),q=this.find("div.ajaxDropDownButtons"),I='<li class="ajaxDropDownLoading';""!==n.locl&&(I+=" "+n.locl),I+='"',""!==n.lost&&(I+=D+n.lost+'"'),I+=">"+n.prba+c;var A=f;""!==n.hecl&&(A+=" "+n.hecl),A+='"',""!==n.hest&&(A+=D+n.hest+'"'),A+=">";var L=n.loca.mcha.replace(/{NUM}/g,n.minq),U=f;""!==n.ercl&&(U+=" "+n.ercl),U+='"',""!==n.erst&&(U+=D+n.erst+'"'),U+=">"+n.loca.erro+c;var E=f;""!==n.nrcl&&(E+=" "+n.nrcl),E+='"',""!==n.nrst&&(E+=D+n.nrst+'"'),E+=">"+n.loca.nrec+c;var M=function(){if(0===P.find(m).length){var e=T.data("page");e=1*e;var r=!1,s=A+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',i=s;i+=n.paen+n.loca.allr+'</li><li class="divider"></li>'+I;var o=S.val();o.length>0?o.length>=n.minq?(i=s,i+=n.paen+n.loca.rcon+" <strong>"+o,i+='</strong></li><li class="divider"></li>'+I,r=!0):i=A+L+c:r=!0,P.html(i),r&&a.post(n.url,{query:o,page:e}).fail(function(){P.append(U),console.log("jQuery post failed")}).done(function(e){var r=a.parseJSON(e);if(void 0===r.total&&(r.total=1),void 0===r.page&&(r.page=1),void 0===r.data)P.append(U),console.log("No data element in results object",e);else if(r.data.length){P.find("span.ajaxDropDownTotalPages").text(r.total);for(var s in r.data){var i=u+r.page+t+r.data[s].id;""!==n.recl&&(i+=" "+n.recl),P.parent().parent().parent().find(h+r.data[s].id).length&&(i+=" "+n.accl),i+='"',""!==n.rest&&(i+=D+n.rest+'"'),i+=d+r.data[s].id+'">',r.data[s].mark&&(i+=n.mabe),i+=r.data[s].value,r.data[s].mark&&(i+=n.maen),i+=l,P.append(i)}if(r.total>1){var o='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(o+=" "+n.swcl),o+='"',""!==n.swst&&(o+=D+n.swst+'"'),o+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(o+=" "+n.prcl),1===r.page&&(o+=" "+n.dicl),o+='"',""!==n.prst&&(o+=D+n.prst+'"'),o+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(o+=" "+n.necl),r.page===r.total&&(o+=" "+n.dicl),o+='"',""!==n.nest&&(o+=D+n.nest+'"'),o+=">"+n.nebe+n.loca.next+n.neen+l,P.append(o)}}else P.append(E)}).always(function(){a("li.ajaxDropDownLoading").remove()})}};return this.on(n.trig,M),this.on("click",r,function(e){e.preventDefault(),e.stopPropagation(),P.find(s).removeClass(n.dicl),P.find(r).addClass(n.dicl);var i=T.data("page");if(i=1*i+1,P.find(v+i).length)P.find(m).addClass(n.hicl),P.find(v+i).removeClass(n.hicl),P.find(r).removeClass(n.dicl);else{var o=S.val();a.post(n.url,{query:o,page:i}).fail(function(){P.append(U),console.log("jQuery post failed")}).done(function(e){var s=a.parseJSON(e);if(void 0===s.data)P.append(U),console.log("No data element in results object",e);else if(s.data.length){P.find(m).addClass(n.hicl),void 0===s.total&&(s.total=1),void 0===s.page&&(s.page=1);for(var o in s.data){var p=u+s.page+t+s.data[o].id;""!==n.recl&&(p+=" "+n.recl),P.parent().parent().parent().find(h+s.data[o].id).length&&(p+=" "+n.accl),p+='"',""!==n.rest&&(p+=D+n.rest+'"'),p+=d+s.data[o].id+'">',s.data[o].mark&&(p+=n.mabe),p+=s.data[o].value,s.data[o].mark&&(p+=n.maen),p+=l,P.find(".divider.ajaxDropDownInfo").before(p)}s.page<s.total?P.find(r).removeClass(n.dicl):i=s.total}else P.append(E)})}T.data("page",i),P.find(g).text(i)}),this.on("click",s,function(a){a.preventDefault(),a.stopPropagation(),P.find(r).removeClass(n.dicl),P.find(s).addClass(n.dicl);var e=T.data("page");e=1*e-1,1>e&&(e=1),P.find(m).addClass(n.hicl),P.find(v+e).removeClass(n.hicl),e>1&&P.find(s).removeClass(n.dicl),T.data("page",e),P.find(g).text(e)}),this.on("keyup",p,function(){window.clearTimeout(j),a(this).parent().find(o).data("page",1),a(this).parent().find(w).find(m).remove(),n.keyt&&(j=window.setTimeout(function(){q.addClass("open"),M()},n.dely))}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var t=a(this).data("id"),l=a(this).html(),r="[]";if(n.smod&&(N.html(""),x=[],a(this).parent().parent().find(m).removeClass(n.accl),r=""),n.smod&&""===n.addc&&!n.smbt)T.hide(),k.show(),S.val(l.replace(/<.*?>/g,"").replace(/"/g,"'")),S.prop("disabled",!0),S.parent().find(".singleResult").length?S.parent().find(".singleResult").val(t):S.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+t+'">'),x.push({id:t,label:l}),y(t,l,x);else if(a(this).parent().hasClass(n.accl))a(this).parent().removeClass(n.accl),N.find(h+t).remove(),C(t),b(t,x);else{a(this).parent().addClass(n.accl);var s='<li class="ajaxDropDownSelected'+t;if(""!==n.rscl&&(s+=" "+n.rscl),s+='"',""!==n.rsst&&(s+=D+n.rsst+'"'),s+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(s+=" "+n.rmcl),s+='"',""!==n.rmst&&(s+=D+n.rmst+'"'),s+=' data-id="'+t+'">'+n.rmla+"</a>",""!==n.addc){var i=n.addc.replace(/{ID}/g,t);i=i.replace(/{VALUE}/g,l),s+=i}s+=l+'<input type="hidden" name="'+n.name+r+'" value="'+t+'" /></li>',N.append(s),x.push({id:t,label:l}),y(t,l,x)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault();var t=a(this).data("id");a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+t).removeClass(n.accl),a(this).parent().remove(),C(t),b(t,x)}),this.on("click",i,function(e){e.preventDefault();var n=a(this).parent().parent().find("input.singleResult"),t=n.val();n.remove(),S.prop("disabled",!1),S.val(""),a(this).hide(),T.show(),C(t),b(t,x)}),this.on("add",function(){var a="[]",e="";n.smod&&(N.html(""),x=[],a="");for(var t in arguments)if(0!=t)if(void 0===arguments[t].id)console.log("No id element in data object",arguments[t]);else{var l=arguments[t].id;if(!R(l)){var r="";void 0!==arguments[t].value&&(r=arguments[t].value);var s=0;1==arguments[t].mark&&(s=1),s&&(r=n.mabe+r+n.maen);var i=n.addc;if(arguments[t].additional===!1?i="":void 0!==arguments[t].additional&&(i=arguments[t].additional),n.smod&&""===n.addc&&!n.smbt)T.hide(),k.show(),S.val(r.replace(/<.*?>/g,"").replace(/"/g,"'")),S.prop("disabled",!0),S.parent().find(".singleResult").length?S.parent().find(".singleResult").val(l):S.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+l+'">'),x.push({id:l,label:r}),n.jsev&&y(l,r,x);else{var e='<li class="ajaxDropDownSelected'+l;if(""!==n.rscl&&(e+=" "+n.rscl),e+='"',""!==n.rsst&&(e+=D+n.rsst+'"'),e+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(e+=" "+n.rmcl),e+='"',""!==n.rmst&&(e+=D+n.rmst+'"'),e+=' data-id="'+l+'">'+n.rmla+"</a>",""!==i){var o=i.replace(/{ID}/g,l);o=o.replace(/{VALUE}/g,r),e+=o}e+=r+'<input type="hidden" name="'+n.name+a+'" value="'+l+'"></li>',n.smbt||(N.append(e),x.push({id:l,label:r}),n.jsev&&y(l,r,x))}}}n.smbt&&""!==e&&(N.append(e),x.push({id:l,label:r}),n.jsev&&y(l,r,x))}),this.on("removeOne",function(){for(var a in arguments)if(0!=a)if(isNaN(arguments[a]))console.log("id is not a number",arguments[a]);else{var e=arguments[a];R(e)&&(N.find(h+e).remove(),C(e),n.jsev&&b(e,x))}}),this.on("removeAll",function(){N.html(""),x=[]}),this}}(jQuery);
