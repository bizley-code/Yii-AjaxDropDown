/*!
 * AjaxDropDown v1.1.1
 * Pawe≈Ç Bizley Brzozowski
 * https://github.com/bizley-code/Yii-AjaxDropDown
 * http://www.yiiframework.com/extension/ajaxdropdown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{accl:"active",addc:"",dicl:"disabled",ercl:"",erst:"",hecl:"",hest:"",hicl:"hidden",locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smod:!1,swcl:"",swst:"",trig:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),r=this.find("ul.ajaxDropDownMenu"),t='<li class="ajaxDropDownLoading';""!==n.locl&&(t+=" "+n.locl),t+='"',""!==n.lost&&(t+=' style="'+n.lost+'"'),t+=">"+n.prba+"</li>";var o='<li class="dropdown-header';""!==n.hecl&&(o+=" "+n.hecl),o+='"',""!==n.hest&&(o+=' style="'+n.hest+'"'),o+=">";var l=n.loca.mcha.replace(/{NUM}/g,n.minq),s='<li class="dropdown-header';""!==n.ercl&&(s+=" "+n.ercl),s+='"',""!==n.erst&&(s+=' style="'+n.erst+'"'),s+=">"+n.loca.erro+"</li>";var p='<li class="dropdown-header';return""!==n.nrcl&&(p+=" "+n.nrcl),p+='"',""!==n.nrst&&(p+=' style="'+n.nrst+'"'),p+=">"+n.loca.nrec+"</li>",this.on(n.trig,function(){if(0===r.find("li.ajaxDropDownPages").length){var e=a(this).find("button.ajaxDropDownToggle").data("page");e=1*e;var d=!1,c=o+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>';c+=n.paen+n.loca.allr+'</li><li class="divider"></li>'+t;var D=a(this).find("input[type=text]").val();n.minq>0?D.length>=n.minq?(c=o+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',c+=n.paen+n.loca.rcon+" <strong>"+D,c+='</strong></li><li class="divider"></li>'+t,d=!0):c=o+l+"</li>":d=!0,r.html(c),d&&a.post(n.url,{query:D,page:e}).fail(function(){r.append(s)}).done(function(e){var t=a.parseJSON(e);if(void 0===t.total&&(t.total=1),void 0===t.page&&(t.page=1),t.data.length){r.find("span.ajaxDropDownTotalPages").text(t.total);for(i in t.data){var o='<li class="ajaxDropDownPages ajaxDropDownPage'+t.page+" ajaxDropDownRecord"+t.data[i].id;""!==n.recl&&(o+=" "+n.recl),r.parent().parent().parent().find("li.ajaxDropDownSelected"+t.data[i].id).length&&(o+=" "+n.accl),o+='"',""!==n.rest&&(o+=' style="'+n.rest+'"'),o+='><a href="#" class="ajaxDropDownResult" data-id="'+t.data[i].id+'">',t.data[i].mark&&(o+=n.mabe),o+=t.data[i].value,t.data[i].mark&&(o+=n.maen),o+="</a></li>",r.append(o)}if(t.total>1){var l='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(l+=" "+n.swcl),l+='"',""!==n.swst&&(l+=' style="'+n.swst+'"'),l+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(l+=" "+n.prcl),1===t.page&&(l+=" "+n.dicl),l+='"',""!==n.prst&&(l+=' style="'+n.prst+'"'),l+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(l+=" "+n.necl),t.page===t.total&&(l+=" "+n.dicl),l+='"',""!==n.nest&&(l+=' style="'+n.nest+'"'),l+=">"+n.nebe+n.loca.next+n.neen+"</a></li>",r.append(l)}}else r.append(p)}).always(function(){a("li.ajaxDropDownLoading").remove()})}}),this.on("click","a.ajaxDropDownNext",function(e){e.preventDefault(),e.stopPropagation(),r.find("a.ajaxDropDownPrev").removeClass(n.dicl),r.find("a.ajaxDropDownNext").addClass(n.dicl);var t=r.parent().find("button.ajaxDropDownToggle").data("page");if(t=1*t+1,r.find("li.ajaxDropDownPage"+t).length)r.find("li.ajaxDropDownPages").addClass(n.hicl),r.find("li.ajaxDropDownPage"+t).removeClass(n.hicl),r.find("a.ajaxDropDownNext").removeClass(n.dicl);else{var o=r.parent().parent().find("input[type=text]").val();a.post(n.url,{query:o,page:t}).fail(function(){r.append(s)}).done(function(e){var o=a.parseJSON(e);if(o.data.length){r.find(".ajaxDropDownPages").addClass(n.hicl),void 0===o.total&&(o.total=1),void 0===o.page&&(o.page=1);for(i in o.data){var l='<li class="ajaxDropDownPages ajaxDropDownPage'+o.page+" ajaxDropDownRecord"+o.data[i].id;""!==n.recl&&(l+=" "+n.recl),r.parent().parent().parent().find("li.ajaxDropDownSelected"+o.data[i].id).length&&(l+=" "+n.accl),l+='"',""!==n.rest&&(l+=' style="'+n.rest+'"'),l+='><a href="#" class="ajaxDropDownResult" data-id="'+o.data[i].id+'">',o.data[i].mark&&(l+=n.mabe),l+=o.data[i].value,o.data[i].mark&&(l+=n.maen),l+="</a></li>",r.find(".divider.ajaxDropDownInfo").before(l)}o.page<o.total?r.find("a.ajaxDropDownNext").removeClass(n.dicl):t=o.total}else r.append(p)})}r.parent().find("button.ajaxDropDownToggle").data("page",t),r.find("span.ajaxDropDownPageNumber").text(t)}),this.on("click","a.ajaxDropDownPrev",function(a){a.preventDefault(),a.stopPropagation(),r.find("a.ajaxDropDownNext").removeClass(n.dicl),r.find("a.ajaxDropDownPrev").addClass(n.dicl);var e=r.parent().find("button.ajaxDropDownToggle").data("page");e=1*e-1,1>e&&(e=1),r.find("li.ajaxDropDownPages").addClass(n.hicl),r.find("li.ajaxDropDownPage"+e).removeClass(n.hicl),e>1&&r.find("a.ajaxDropDownPrev").removeClass(n.dicl),r.parent().find("button.ajaxDropDownToggle").data("page",e),r.find("span.ajaxDropDownPageNumber").text(e)}),this.on("keyup","input[type=text]",function(){a(this).parent().find("button.ajaxDropDownToggle").data("page",1),a(this).parent().find("ul.ajaxDropDownMenu").find("li.ajaxDropDownPages").remove()}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var r=a(this).data("id"),t=a(this).html(),o=a(this).parent().parent().parent().parent().parent().find("ul.ajaxDropDownResults"),l="[]";if(n.smod&&(o.html(""),a(this).parent().parent().find("li.ajaxDropDownPages").removeClass(n.accl),l=""),a(this).parent().hasClass(n.accl))a(this).parent().removeClass(n.accl),o.find("li.ajaxDropDownSelected"+r).remove();else{a(this).parent().addClass(n.accl),n.smod&&(l="");var s='<li class="ajaxDropDownSelected'+r;""!==n.rscl&&(s+=" "+n.rscl),s+='"',""!==n.rsst&&(s+=' style="'+n.rsst+'"'),s+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(s+=" "+n.rmcl),s+='"',""!==n.rmst&&(s+=' style="'+n.rmst+'"'),s+=' data-id="'+r+'">'+n.rmla+"</a>"+n.addc+t+'<input type="hidden" name="'+n.name+l+'" value="'+r+'" /></li>',o.append(s)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault(),a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+a(this).data("id")).removeClass(n.accl),a(this).parent().remove()}),this}}(jQuery);
